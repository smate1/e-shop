<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Корзина | Shop</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="src/main.css">
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">
        <i class="bi bi-shop"></i> Shop
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Главная</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="catalog.html">Каталог</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="faq.html">FAQ</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="terms.html">Пользовательское соглашение</a>
          </li>
        </ul>

        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="cart.html">
              <i class="bi bi-cart3"></i> Корзина
              <span class="badge bg-secondary cart-count" style="display: none;">0</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link login-button" href="auth.html">
              <i class="bi bi-person"></i> Войти
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="py-4">
    <div class="container">
      <!-- Page Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h1 class="display-4 fw-bold mb-3">Корзина</h1>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="index.html" class="text-decoration-none">Главная</a></li>
              <li class="breadcrumb-item active" aria-current="page">Корзина</li>
            </ol>
          </nav>
        </div>
      </div>

      <!-- Cart Content -->
      <div class="row" style="justify-content: center;">
        <div class="col-lg-8">
          <!-- Cart Items -->
          <div id="cartItems">
            <!-- Cart items will be loaded here -->
          </div>

          <!-- Empty Cart Message -->
          <div id="emptyCart" class="text-center py-5" style="display: none;">
            <i class="bi bi-cart-x display-1 text-muted mb-3"></i>
            <h3 class="text-muted mb-3">Ваша корзина пуста</h3>
            <p class="text-muted mb-4">Добавьте товары из каталога</p>
            <a href="catalog.html" class="btn btn-primary btn-lg">
              <i class="bi bi-shop"></i> Перейти в каталог
            </a>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="col-lg-4" id="orderSummary" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Сумма заказа</h5>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <span>Товары (<span id="itemsCount">0</span>):</span>
                <span id="subtotal">0 ₽</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Доставка:</span>
                <span id="shipping">Бесплатно</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between fw-bold">
                <span>Итого:</span>
                <span id="total" class="h5 text-primary">0 ₽</span>
              </div>
              <button class="btn btn-success w-100 mt-3" id="checkoutBtn">
                <i class="bi bi-credit-card"></i> Оформить заказ
              </button>
            </div>
          </div>

          <!-- Promo Code -->
          <div class="card mt-3" id="promoCard" style="display: none;">
            <div class="card-body">
              <h6 class="card-title">Промокод</h6>
              <div class="input-group">
                <input type="text" class="form-control" placeholder="Введите промокод" id="promoInput">
                <button class="btn btn-outline-primary" type="button" id="applyPromo">
                  Применить
                </button>
              </div>
            </div>
          </div>

          <!-- Delivery Info -->
          <div class="card mt-3" id="deliveryCard" style="display: none;">
            <div class="card-body">
              <h6 class="card-title">
                <i class="bi bi-truck text-primary"></i> Доставка
              </h6>
              <p class="small text-muted mb-0">
                Бесплатная доставка при заказе от 3000 ₽
              </p>
              <p class="small text-muted mb-0">
                Доставка в течение 1-3 рабочих дней
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-light py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h5>Shop</h5>
          <p>Интернет-магазин качественных товаров</p>
        </div>
        <div class="col-md-6">
          <h6>Полезные ссылки</h6>
          <ul class="list-unstyled" style="display: flex;">
            <li><a href="faq.html" class="text-light text-decoration-none">FAQ</a></li>
            <li><a href="terms.html" class="text-light text-decoration-none">Пользовательское соглашение</a></li>
            <li><a href="auth.html" class="text-light text-decoration-none">Войти в аккаунт</a></li>
          </ul>
        </div>
      </div>
      <hr>
      <div class="text-center">
        <p>&copy; 2024 Shop. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/src/main.js"></script>
  <script>
    // Cart functionality
    document.addEventListener('DOMContentLoaded', function () {
      loadCartItems();

      // Checkout button
      document.getElementById('checkoutBtn').addEventListener('click', function () {
        // Check if user is logged in
        const userData = localStorage.getItem('userData') || sessionStorage.getItem('userData');
        if (!userData) {
          alert('Для оформления заказа необходимо войти в аккаунт');
          window.location.href = 'auth.html';
          return;
        }

        alert('Функционал оформления заказа будет добавлен позже');
      });

      // Promo code
      document.getElementById('applyPromo').addEventListener('click', function () {
        const promoCode = document.getElementById('promoInput').value;
        if (promoCode.toLowerCase() === 'welcome10') {
          alert('Промокод применен! Скидка 10%');
          // Apply discount logic here
        } else {
          alert('Неверный промокод');
        }
      });
    });

    function loadCartItems() {
      const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
      const cartItemsContainer = document.getElementById('cartItems');
      const emptyCart = document.getElementById('emptyCart');
      const orderSummary = document.getElementById('orderSummary');
      const promoCard = document.getElementById('promoCard');
      const deliveryCard = document.getElementById('deliveryCard');

      if (cartItems.length === 0) {
        cartItemsContainer.innerHTML = '';
        emptyCart.style.display = 'block';
        orderSummary.style.display = 'none';
        promoCard.style.display = 'none';
        deliveryCard.style.display = 'none';

        // Update cart count in navigation when empty
        const cartCount = document.querySelector('.cart-count');
        if (cartCount) {
          cartCount.style.display = 'none';
        }
        return;
      }

      emptyCart.style.display = 'none';
      orderSummary.style.display = 'block';
      promoCard.style.display = 'block';
      deliveryCard.style.display = 'block';

      cartItemsContainer.innerHTML = '';
      let subtotal = 0;

      cartItems.forEach((item, index) => {
        const itemTotal = parseFloat(item.price) * item.quantity;
        subtotal += itemTotal;

        const cartItemHTML = `
          <div class="card mb-3">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-2">
                  <img src="https://via.placeholder.com/100x100" class="img-fluid rounded" alt="${item.name}">
                </div>
                <div class="col-md-4">
                  <h6 class="mb-0">${item.name}</h6>
                  <small class="text-muted">ID: ${item.id}</small>
                </div>
                <div class="col-md-2">
                  <span class="fw-bold">${parseFloat(item.price).toLocaleString()} ₽</span>
                </div>
                <div class="col-md-2">
                  <div class="input-group input-group-sm">
                    <button class="btn btn-outline-secondary" type="button" onclick="updateQuantity(${index}, -1)">-</button>
                    <input type="number" class="form-control text-center" value="${item.quantity}" min="1" onchange="setQuantity(${index}, this.value)">
                    <button class="btn btn-outline-secondary" type="button" onclick="updateQuantity(${index}, 1)">+</button>
                  </div>
                </div>
                <div class="col-md-2 text-end">
                  <div class="fw-bold text-primary mb-2">${itemTotal.toLocaleString()} ₽</div>
                  <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;

        cartItemsContainer.innerHTML += cartItemHTML;
      });

      // Update summary
      document.getElementById('itemsCount').textContent = cartItems.length;
      document.getElementById('subtotal').textContent = subtotal.toLocaleString() + ' ₽';
      document.getElementById('total').textContent = subtotal.toLocaleString() + ' ₽';

      // Update cart count in navigation
      const cartCount = document.querySelector('.cart-count');
      if (cartCount) {
        cartCount.textContent = cartItems.length;
        cartCount.style.display = cartItems.length > 0 ? 'inline' : 'none';
      }
    }

    function updateQuantity(index, change) {
      const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
      cartItems[index].quantity += change;

      if (cartItems[index].quantity <= 0) {
        cartItems.splice(index, 1);
      }

      localStorage.setItem('cartItems', JSON.stringify(cartItems));
      loadCartItems();
    }

    function setQuantity(index, quantity) {
      const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
      cartItems[index].quantity = Math.max(1, parseInt(quantity));
      localStorage.setItem('cartItems', JSON.stringify(cartItems));
      loadCartItems();
    }

    function removeItem(index) {
      const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
      cartItems.splice(index, 1);
      localStorage.setItem('cartItems', JSON.stringify(cartItems));
      loadCartItems();
    }
  </script>
</body>

</html>